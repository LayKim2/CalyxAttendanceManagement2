@page "/register"

@inject IAuthService AuthService
@inject Radzen.DialogService DialogService
@inject NavigationManager NavigationManager


<div class="col-12 d-flex p-3" style="justify-content: center;">
    <RadzenCard class="d-flex m-5 p-0 rz-border-radius-6 rz-shadow-10" Style="width: 50%; flex-flow: row wrap; overflow: hidden; align-items: stretch;">

        <RadzenTemplateForm TItem="UserRegister" Data="@user" Style="width:100%" Submit="HandleRegistraion">

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <RadzenCard Class="rz-shadow-0 rz-border-radius-0 p-5 d-flex justify-center" style="flex: 1 14rem; text-align: center; background: no-repeat 100% 70% fixed url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwNCIgaGVpZ2h0PSIxNDU4IiB2aWV3Qm94PSIwIDAgMTIwNCAxNDU4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBvcGFjaXR5PSIwLjUiIGZpbHRlcj0idXJsKCNmaWx0ZXIwX2ZfNDkzXzEwMTM0KSI+CjxjaXJjbGUgY3g9IjcyMi4xMjgiIGN5PSI4MzkuMDIiIHI9IjQ4MS40MTkiIGZpbGw9InVybCgjcGFpbnQwX3JhZGlhbF80OTNfMTAxMzQpIi8+CjwvZz4KPGcgb3BhY2l0eT0iMC41IiBmaWx0ZXI9InVybCgjZmlsdGVyMV9mXzQ5M18xMDEzNCkiPgo8Y2lyY2xlIGN4PSI0NzAuMzMzIiBjeT0iNTcwLjMzMyIgcj0iNDcwLjMzMyIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ5M18xMDEzNCkiLz4KPC9nPgo8ZyBvcGFjaXR5PSIwLjUiIGZpbHRlcj0idXJsKCNmaWx0ZXIyX2ZfNDkzXzEwMTM0KSI+CjxjaXJjbGUgY3g9IjY5MS41MTEiIGN5PSI1MjIuMjk3IiByPSIzMzEuNTAzIiBmaWxsPSJ1cmwoI3BhaW50Ml9yYWRpYWxfNDkzXzEwMTM0KSIvPgo8L2c+CjxnIG9wYWNpdHk9IjAuNSIgZmlsdGVyPSJ1cmwoI2ZpbHRlcjNfZl80OTNfMTAxMzQpIj4KPGNpcmNsZSBjeD0iNjA4LjI0NCIgY3k9IjEwNzkuOTciIHI9IjMzMS41MDMiIHRyYW5zZm9ybT0icm90YXRlKC04MS4yMjQ0IDYwOC4yNDQgMTA3OS45NykiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80OTNfMTAxMzQpIi8+CjwvZz4KPGRlZnM+CjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZl80OTNfMTAxMzQiIHg9IjE0MC43MDkiIHk9IjI1Ny42MDEiIHdpZHRoPSIxMTYyLjg0IiBoZWlnaHQ9IjExNjIuODQiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjFfZl80OTNfMTAxMzQiIHg9Ii0xMDAiIHk9IjAiIHdpZHRoPSIxMTQwLjY3IiBoZWlnaHQ9IjExNDAuNjciIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjJfZl80OTNfMTAxMzQiIHg9IjI2MC4wMDgiIHk9IjkwLjc5MzkiIHdpZHRoPSI4NjMuMDA2IiBoZWlnaHQ9Ijg2My4wMDYiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjNfZl80OTNfMTAxMzQiIHg9IjE3Ni42OTQiIHk9IjY0OC40MjMiIHdpZHRoPSI4NjMuMSIgaGVpZ2h0PSI4NjMuMSIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgcmVzdWx0PSJzaGFwZSIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI1MCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzQ5M18xMDEzNCIvPgo8L2ZpbHRlcj4KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDBfcmFkaWFsXzQ5M18xMDEzNCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg3MjIuMTI4IDgzOS4wMikgcm90YXRlKDkwKSBzY2FsZSg0ODEuNDE5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiNGRjFBNkMiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxQTZDIiBzdG9wLW9wYWNpdHk9IjAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDFfcmFkaWFsXzQ5M18xMDEzNCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg0NzAuMzMzIDU3MC4zMzMpIHJvdGF0ZSg5MCkgc2NhbGUoNDcwLjMzMykiPgo8c3RvcCBzdG9wLWNvbG9yPSIjM0FBQ0ZGIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzNBOTVGRiIgc3RvcC1vcGFjaXR5PSIwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQyX3JhZGlhbF80OTNfMTAxMzQiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjkxLjUxMSA1MjIuMjk3KSByb3RhdGUoOTApIHNjYWxlKDMzMS41MDMpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzQ4M0FGRiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM0ODNBRkYiIHN0b3Atb3BhY2l0eT0iMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50M19yYWRpYWxfNDkzXzEwMTM0IiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDYwOC4yNDQgMTA3OS45Nykgcm90YXRlKDkwKSBzY2FsZSgzMzEuNTAzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiNGRkM4M0EiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkZDODNBIiBzdG9wLW9wYWNpdHk9IjAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K')" >
                                @*<RadzenText TextStyle="TextStyle.DisplayH2" TagName="TagName.H2" Class="rz-color-white mb-4">Welcome!</RadzenText>    
                                <RadzenText TextStyle="TextStyle.H6" Class="rz-color-white">Manage your information!</RadzenText>
                                <RadzenText TextStyle="TextStyle.Body2" Class="rz-color-white">Let's get started with your <strong>30 days</strong> trial.</RadzenText>*@
                                <MudImage Src="/images/ic-calyx.png" ObjectFit="ObjectFit.Contain" ObjectPosition="ObjectPosition.Center"/>
                            </RadzenCard>
                        </div>

                        <RadzenFieldset>
                            <HeaderTemplate>
                                <span class="d-inline-flex align-items-center align-middle">
                                    <RadzenLabel class="me-1" Text="Sign up" Style="font-size:25px;"/>
                                </span>
                            </HeaderTemplate>
                            <ChildContent>
                                <DataAnnotationsValidator />
                                <div class="row">
                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="Company Email" />
                                    </div>
                                    <div class="col-md-10">
                                        <RadzenTextBox TItem="string?" @bind-Value="@user.Email" Name="Email" Style="min-width:250px;" Placeholder="example@calyxsoftware.com" /><br />
                                        <RadzenRequiredValidator Component="Email" Text="Company email is required" />
                                        <RadzenRegexValidator Component="Email" Text="Email address must be from 'calyxsoftware.com'" Pattern="@pattern" />
                                    </div>
                                </div><br />

                                <div class="row">
                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="First Name" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenTextBox TItem="string?" @bind-Value="@user.FirstName" Name="FirstName" Placeholder="Gildong" />
                                        <RadzenRequiredValidator Component="FirstName" Text="First name is required" />
                                    </div>

                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="Last Name" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenTextBox TItem="string?" @bind-Value="@user.LastName" Name="LastName" Placeholder="Hong" />
                                        <RadzenRequiredValidator Component="LastName" Text="Last name is required" />
                                    </div>

                                </div><br />

                                <div class="row">
                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="Password" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenPassword TItem="string?" @bind-Value="@user.Password" Name="Password" Placeholder="6자 이상" /><br />
                                        <RadzenLengthValidator Component="Password" Min="6" Max="20" Text="Length is 6 ~ 20" />
                                        <RadzenRequiredValidator Component="Password" Text="Password is required" />
                                    </div>

                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="ConfirmPassword" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenPassword TItem="string?" @bind-Value="@user.ConfirmPassword" Name="ConfirmPassword" /><br />
                                        <RadzenRequiredValidator Component="ConfirmPassword" Text="ConfirmPassword is required" />
                                        <RadzenCompareValidator Value=@user.Password Component="ConfirmPassword" Text="Passwords should be the same" />
                                    </div>

                                </div><br />

                                <div class="row">
                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="소속" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenDropDown @bind-Value=@user.Belong Name="Belong" Data=@belongType />
                                        <RadzenRequiredValidator Component="Belong" Text="Belong is required" />
                                    </div>

                                    <div class="col-md-2 align-items-center d-flex">
                                        <RadzenLabel Text="입사일" />
                                    </div>
                                    <div class="col-md-4">
                                        <RadzenDatePicker TItem="datetime?" @bind-Value=@user.StartWorkDate DateFormat="MM/dd/yyyy" Max="DateTime.Today" />
                                    </div>
                                </div>
                            </ChildContent>
                        </RadzenFieldset>
                    </div>
                </div>

                <div class="row col-md-12 justify-content-center" sstyle="margin">
                    <div class="col-md-12 d-flex align-items-end justify-content-center" style="margin-top:30px; margin-bottom:30px;">
                        <RadzenButton Shade="Radzen.Shade.Lighter" ButtonStyle="ButtonStyle.Light" style="display: inline-block; margin-right:50px;" Text="Back" Click="NavigateToLogin" />
                        <RadzenButton ButtonType="Radzen.ButtonType.Submit" Shade="Shade.Darker" ButtonStyle="ButtonStyle.Info" Text="Sign up" />
                    </div>
                </div>

            </div>
        </RadzenTemplateForm>
    </RadzenCard>
</div>

<div class="col-12 d-flex p-3" style="justify-content: center;">
    ©Calyx Technology, Inc. All rights reserved.
</div>

@code {
    DateTime? date = DateTime.Today;
    UserRegister user = new();
    string pattern = @"^[a-zA-Z0-9._%+-]+@calyxsoftware.com$";

    IList<string> belongType = new List<string>()
    {
        "Path",
        "Zip",
        "QA",
    };

    async Task ShowBusyDialog(string message)
    {
        await BusyDialog(message);
    }

    async Task BusyDialog(string message)
    {
        await DialogService.OpenAsync("", ds =>
        {
            RenderFragment content = b =>
            {
                b.OpenElement(0, "div");
                b.AddAttribute(1, "class", "row");

                b.OpenElement(2, "div");
                b.AddAttribute(3, "class", "col-md-12");

                b.AddContent(4, message);

                b.CloseElement();
                b.CloseElement();
            };
            return content;
        }, new Radzen.DialogOptions() { ShowTitle = false, Style = "min-height:auto;min-width:auto;width:auto", CloseDialogOnEsc = false });
    }

    private async Task HandleRegistraion()
    {
        ShowBusyDialog("Register...");

        var result = await AuthService.Register(user);

        await DialogService.Alert(result.Message, "Calyx", new AlertOptions() { OkButtonText = "Yes" });

        DialogService.Close();

        if (result.Success)
        {
            await NavigateToLogin();
        }

    }

    private async Task NavigateToLogin()
    {
        NavigationManager.NavigateTo("login");
    }
}